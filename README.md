# Cancer Drug Diversity - Linux and Data Analysis Capstone Project

## Background and Data Sources

In her [Wall Street Journal article](https://www.wsj.com/health/healthcare/cancer-treatment-personalized-doctors-170f4be6), health reporter Brianna Abbot underscored how local oncologists struggle to stay up-to-date with developing cancer treatments, resulting in a gap in the accuracy of diagnosis and effectiveness of treatment between local care and larger specialized cancer centers. Building on Abbot’s claim, I attempted to quantify “the gap” by calculating the average number of unique cancer prescriptions in counties across the United States of population densities. 

My hypothesis is that there are more diverse cancer treatment options in urban areas with larger populations. I used four datasets to investigate my hypothesis: the [2022 Medicare Prescriptions ](https://data.cms.gov/provider-summary-by-type-of-service/medicare-part-d-prescribers/medicare-part-d-prescribers-by-provider-and-drug) dataset, the [Doctor NPI Numbers](https://npiregistry.cms.hhs.gov/search) dataset (/data/raw/DoctorNPInumbers), the [US Cities](https://simplemaps.com/data/us-cities) dataset, and the [US Census estimates on County Populations in 2022](https://www.census.gov/data/tables/time-series/demo/popest/2020s-counties-total.html).

## Data Pipeline

Starting with the Medicare Prescriptions dataset, I filtered out all of the drugs prescribed by the oncology and hematology department and hand-checked the unique prescriptions to exclude any drugs not exclusively used to treat cancer. This left me with a list of 217 unique drugs to search for in the Prescriptions dataset independent of prescriber type (i.e., cancer drugs not only prescribed by oncologists). I extracted the NPI, Brand, Generic, City, and State fields for records that matched the Brand/Generic entries in my search list (`prescCancerDrugNPI.awk`). I used the NPI numbers from these filtered results to “look up” the ZIP code associated with each record (`CancerPrescNPILocations.awk`). Then, using the US Cities dataset, I converted ZIP codes into counties, then filtered out duplicate lines (`countyMatching.py` with `sort`, `uniq` from the command line).

I used PySpark to create county/prescription key-data pairs converted the prescription into 1s reduced by key and got the number of unique prescriptions per county (`countsPerCounty.py`). Then, I replaced the key for counties with the respective population estimates from the 2020 Census dataset (`countyPopulations.py`). I aggregated data by county population size to the tenth power (≤100, ≤1,000, etc.), and found the average number of unique prescriptions per category (`avgCountyAmts.py`). Finally, I graphed a scatter plot of the average diversity rate for each county, with the size of the point corresponding to the number of counties that fit into the category (`graphres.py`).

The graph suggests a correlation between population size and the diversity of prescribed cancer treatments. The point representing county populations of ≤100 seems to be an outlier because it demonstrates higher diversity than the counties with populations of up to ≤100,000. One reason for this is that few small counties are represented in the data. Furthermore, [the United States has 3,144 counties/county equivalents](https://en.wikipedia.org/wiki/List_of_United_States_counties_and_county_equivalents), and only 1985 are present in the data, and it is possible that the counties with smaller populations are underrepresented in the data because those areas are underreported. However, it is also possible that in very small counties, it is easier for doctors to treat patients because there are fewer people to treat overall. Another weakness of this analysis is that this count only considers prescriptions that are not used to treat other conditions. I chose to only consider cancer-specific drugs to account for how cancer-specific treatments may be prescribed by primary-care providers due to a lack of oncology-specific care in low-population areas. However, omitting general-purpose drugs that are used to treat a variety of diseases including cancer likely altered the averages and subsequent apparent correlation. 

## Results
Contents of `Cancer_Drug_Diversity_by_County_Results.pdf` output file:
![Cancer_Drug_Diversity_by_County_Results](https://github.com/user-attachments/assets/dbc50c45-eaa9-4204-bc4f-2d2e0d177fa6)

